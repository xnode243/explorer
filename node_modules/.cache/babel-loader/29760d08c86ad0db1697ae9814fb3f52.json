{"ast":null,"code":"import \"core-js/modules/es.array.sort.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.array.includes.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport \"core-js/modules/es.object.keys.js\";\nimport \"core-js/modules/es.object.values.js\";\nimport \"core-js/modules/es.error.cause.js\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { getLocalAccounts, getLocalChains } from '@/libs/utils';\nimport { BRow, BCol, BCard, BCardTitle, BAvatar, VBTooltip } from 'bootstrap-vue';\nimport FlipCountdown from 'vue2-flip-countdown';\nimport dayjs from 'dayjs';\nexport default {\n  name: 'WalletUpgradeEvents',\n  components: {\n    BAvatar: BAvatar,\n    BRow: BRow,\n    BCol: BCol,\n    BCard: BCard,\n    BCardTitle: BCardTitle,\n    FlipCountdown: FlipCountdown\n  },\n  directives: {\n    'b-tooltip': VBTooltip\n  },\n  props: {\n    content: {\n      type: String,\n      default: function _default() {\n        return '';\n      }\n    }\n  },\n  data: function data() {\n    return {\n      proposals: [],\n      latest: {}\n    };\n  },\n  computed: {\n    list: function list() {\n      var _this = this;\n\n      return this.proposals.filter(function (x) {\n        return [2, 3].includes(x.status);\n      }).map(function (x) {\n        var x2 = x;\n        x2.countdown = _this.estmatetime(x.chain.chain_name, x.contents.plan);\n        x2.variant = dayjs().isAfter(dayjs(x2.countdown)) ? 'dark' : '';\n        return x2;\n      }).sort(function (a, b) {\n        return dayjs(b.voting_end_time).unix() - dayjs(a.voting_end_time).unix();\n      });\n    }\n  },\n  mounted: function mounted() {\n    var _this2 = this;\n\n    var accounts = getLocalAccounts();\n\n    if (accounts) {\n      var chains = getLocalChains();\n      var toQuery = {};\n      Object.keys(accounts).forEach(function (acc) {\n        accounts[acc].address.forEach(function (add) {\n          var conf = chains[add.chain];\n\n          if (conf) {\n            toQuery[add.chain] = conf;\n          }\n        });\n      });\n      Object.values(toQuery).forEach(function (item) {\n        _this2.fetchProposals(item);\n      });\n    }\n  },\n  methods: {\n    estmatetime: function estmatetime(chainname, plan) {\n      if (plan.height > 0) {\n        var latest = this.latest[chainname];\n\n        if (latest) {\n          var gap = plan.height - this.latest[chainname].height;\n\n          if (gap > 0) {\n            return dayjs().add(gap * 6, 'second').format('YYYY-MM-DD hh:mm:ss');\n          }\n        }\n\n        return '1990-01-01';\n      }\n\n      return dayjs(plan.time).format('YYYY-MM-DD hh:mm:ss');\n    },\n    fetchProposals: function fetchProposals(item) {\n      var _this3 = this;\n\n      this.$http.getGovernanceList('', item).then(function (data) {\n        data.proposals.forEach(function (p) {\n          var type = p.contents['@type'];\n\n          if (type.indexOf('SoftwareUpgradeProposal') > 0) {\n            var p2 = p;\n            p2.chain = item;\n\n            if (dayjs(p.voting_end_time).add(15, 'day').isAfter(dayjs())) {\n              _this3.proposals.push(p2);\n            }\n          }\n        });\n      }, function (err) {\n        throw new Error(err);\n      });\n      this.$http.getLatestBlock(item).then(function (b) {\n        _this3.$set(_this3.latest, item.chain_name, b.block.header);\n      });\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"module"}