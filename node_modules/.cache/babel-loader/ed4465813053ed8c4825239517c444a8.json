{"ast":null,"code":"//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { BProgress, BProgressBar } from 'bootstrap-vue';\nexport default {\n  components: {\n    BProgress,\n    BProgressBar\n  },\n  props: {\n    hash: {\n      type: String,\n      default: null\n    },\n    selectedChain: {\n      type: Object,\n      default: null\n    }\n  },\n\n  data() {\n    return {\n      isLoading: true,\n      succeed: false,\n      error: '',\n      checkTimes: 0\n    };\n  },\n\n  computed: {\n    progresBar() {\n      // success: [100, 0, 0]\n      // fail: [50, 50, 0]\n      // pending: [0, 0, 100]\n      if (!this.hash) {\n        return [0, 0, 100];\n      }\n\n      if (this.succeed) {\n        return [100, 0, 0];\n      }\n\n      return [50, 0, 50];\n    },\n\n    txUrl() {\n      const chain = this.selectedChain ? this.selectedChain.chain_name : this.$store.state.chains.selected.chain_name;\n      return `/${chain}/tx/${this.hash}`;\n    }\n\n  },\n\n  mounted() {\n    this.timer = setInterval(this.trace, 6000);\n  },\n\n  beforeDestroy() {\n    clearInterval(this.timer);\n  },\n\n  methods: {\n    trace() {\n      if (this.hash) {\n        this.error = null;\n        this.$http.getTxs(this.hash, this.selectedChain).then(res => {\n          if (res.code === 0) {\n            this.succeed = true;\n            this.isLoading = false;\n            clearInterval(this.timer);\n            const elem = document.getElementById('txevent');\n\n            if (elem) {\n              const event = new Event('txcompleted', res);\n              elem.dispatchEvent(event);\n            }\n          } else if (res.code !== 3) {\n            // code 3 is tx unconfirmed(not founded).\n            this.error = res.raw_log;\n            clearInterval(this.timer);\n          }\n        }, () => {\n          // error statement\n          this.checkTimes += 1;\n\n          if (this.checkTimes > 5) {\n            clearInterval(this.timer);\n            this.error = 'Timeout';\n          }\n        }).catch(e => {\n          this.error = e;\n          clearInterval(this.timer);\n        });\n      }\n    }\n\n  }\n};","map":null,"metadata":{},"sourceType":"module"}